(function($){$.fn._speedTest=function(options){function foo(){var stest=$.extend({fileSize:null,fileType:null,fileUrl:null,waitingText:null,errorText:null},options),duration,download,startTime,endTime,bitsLoaded,cacheBuster,speedMbps,speedKbps,speedBps,p;if(stest.fileType=="text"){download=new Document}else if(stest.fileType=="image"){download=new Image}if(stest.errorText){download.onerror=function(err,msg){$(this).text(stest.errorText)}}startTime=(new Date).getTime();console.log("startTime:"+startTime);cacheBuster="?spdt="+startTime;download.src=stest.fileUrl+cacheBuster;p=function see(){endTime=(new Date).getTime();console.log("endTime:"+endTime);duration=Math.max(endTime-startTime,1)/1e3;console.log("duration:"+duration);bitsLoaded=stest.fileSize*8;speedBps=(bitsLoaded/duration).toFixed(2);console.log(speedBps);speedKbps=(speedBps/1024).toFixed(2);console.log(speedKbps);speedMbps=(speedKbps/1024).toFixed(2);console.log(speedMbps);return speedMbps};$(download).on("load",function callback(){p();if(stest.onLoad){stest.onLoad.call(this,duration,speedMbps)}}).on("error",function(err,msg){p();if(stest.onError){stest.onError.call(this,duration,speedMbps,event)}});return p}return this.each(function(){var g=foo()})}})(jQuery);
